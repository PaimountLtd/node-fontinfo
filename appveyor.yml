image:
  - Visual Studio 2017

environment:
  matrix:
    - RuntimeURL: https://atom.io/download/atom-shell
      RuntimeName: iojs
      RuntimeVersion: v4.1.4
      
  NodeVersion: 10
  BuildDirectory: build
  Generator: Visual Studio 15 2017 Win64
  DistributeDirectory: distribute
  FullDistributePath: $(SLBuildDirectory)\$(SLDistributeDirectory)
  DistributionAritfact: $(RuntimeName)-$(RuntimeVersion)-node-fontinfo

install:
  - ps: Install-Product node $env:NodeVersion
  - yarn install

build_script:
  - cmake -H. -B"%BuildDirectory%" -G"%Generator%"  -DCMAKE_INSTALL_PREFIX="%FullDistributePath%\node-fontinfo" -DNODEJS_NAME=%RuntimeName% -DNODEJS_URL=%RuntimeURL% -DNODEJS_VERSION=%RuntimeVersion%
  - cmake --build %BuildDirectory% --target install --config RelWithDebInfo
  - tar cvaf "%DistributionAritfact%.tar.gz" -C "%FullDistributePath%" "node-fontinfo"

before_deploy:
  - ps: Push-AppveyorArtifact "$env:DistributionAritfact.tar.gz"

deploy:
  - provider: GitHub
    artifact: $(DistributionAritfact).tar.gz
    auth_token:
      secure: PlcOEW4FL0bs3ISd3l3wAiG7Yw3c9NCuUANZFpD1khIisBgiOAeqz3Jcx+jQyLZE
    draft: false
    prerelease: false
    force_update: true
    on:
      appveyor_repo_tag: true

artifacts:
  - path: $(DistributionAritfact).tar.gz
    name: Distribution Aritfact

test: off